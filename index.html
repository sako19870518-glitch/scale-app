<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>スケール変換</title>

<style>
body{
  font-family: system-ui, sans-serif;
  margin:0; padding:20px;
  background:#fafafa; color:#111;
}
.container{
  max-width:360px; margin:0 auto;
}
label{
  font-size:14px; font-weight:600;
  display:block; text-align:center;
  margin-bottom:4px;
}
.row{
  display:flex; justify-content:center; gap:6px;
  margin-bottom:14px;
}
input{
  width:80px; height:38px;
  font-size:18px;
  text-align:center;
  border:1px solid #ccc;
  border-radius:8px;
}
#formula{
  text-align:center; font-size:18px; font-weight:700;
  margin:16px 0;
}
.keypad{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:6px;
  margin-top:18px;
}
.key{
  height:48px;
  background:#fff;
  border-radius:8px;
  border:1px solid #ccc;
  display:flex; align-items:center; justify-content:center;
  font-size:20px; font-weight:700;
  cursor:pointer;
  user-select:none;
}
</style>
</head>

<body>
<div class="container">

  <!-- 変換前 -->
  <label>変換前</label>
  <div class="row">
    <input id="x1" type="number" />
    <input id="x2" type="number" />
  </div>

  <!-- 変換後 -->
  <label>変換後</label>
  <div class="row">
    <input id="y1" type="number" />
    <input id="y2" type="number" />
  </div>

  <!-- 計算式 -->
  <div id="formula">y = ax + b</div>

  <!-- 測定値・結果 -->
  <label>測定値</label>
  <div class="row">
    <input id="xm" type="number" />
    <input id="ym" type="number" readonly />
  </div>

  <!-- テンキー -->
  <div class="keypad">
    <div class="key">1</div><div class="key">2</div><div class="key">3</div>
    <div class="key">4</div><div class="key">5</div><div class="key">6</div>
    <div class="key">7</div><div class="key">8</div><div class="key">9</div>
    <div class="key">0</div><div class="key">.</div><div class="key">←</div>
  </div>

</div>

<script>
const x1=document.getElementById("x1");
const y1=document.getElementById("y1");
const x2=document.getElementById("x2");
const y2=document.getElementById("y2");
const xm=document.getElementById("xm");
const ym=document.getElementById("ym");
const formula=document.getElementById("formula");

/* ✅ デフォルト値（指示通り） */
x1.value="4";
y1.value="0";
x2.value="20";
y2.value="";
xm.value="";
ym.value="";

/* ✅ 小数点以下余計な0を消す */
function fmt(n){ return Number(n.toFixed(6)).toString(); }

/* ✅ 計算 */
function calc(){
  const X1=parseFloat(x1.value), Y1=parseFloat(y1.value);
  const X2=parseFloat(x2.value), Y2=parseFloat(y2.value);
  if(isFinite(X1)&&isFinite(Y1)&&isFinite(X2)&&isFinite(Y2)&&X1!==X2){
    const a=(Y2-Y1)/(X2-X1);
    const b=Y1-a*X1;
    formula.textContent=`y = ${fmt(a)}x + ${fmt(b)}`;
    const XM=parseFloat(xm.value);
    ym.value=isFinite(XM)?fmt(a*XM+b):"";
  }else{
    formula.textContent="y = ax + b";
    ym.value="";
  }
}

/* ✅ 入力で即反映 */
[x1,y1,x2,y2,xm].forEach(e=>e.addEventListener("input",calc));

/* ✅ タップで全選択（消えるのではなく選択） */
document.querySelectorAll("input").forEach(inp=>{
  inp.addEventListener("focus",()=>inp.select());
});

/* ✅ テンキー */
let tgt=null;
document.querySelectorAll("input").forEach(inp=>{
  inp.addEventListener("focus",()=>tgt=inp);
});
document.querySelectorAll(".key").forEach(k=>{
  k.addEventListener("click",()=>{
    if(!tgt) return;
    const v=k.textContent;
    if(v==="←") tgt.value=tgt.value.slice(0,-1);
    else tgt.value+=v;
    calc();
  });
});
</script>
</body>
</html>
