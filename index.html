<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>スケール変換</title>

<style>
  body {
    font-family: sans-serif;
    background:#fafafa;
    margin:0; padding:20px;
    display:flex;
    justify-content:center;
    text-align:center;
  }

  .container {
    width: 300px;
  }

  .section-label {
    font-size:14px;
    font-weight:bold;
    margin:14px 0 6px 0;
    text-align:left;
  }

  .row {
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin:6px 0;
  }

  input.box {
    width:110px;
    height:38px;
    font-size:18px;
    text-align:right;
    border:1px solid #777;
    border-radius:6px;
  }

  #formula {
    width:100%;
    margin:14px 0;
    padding:10px;
    border:1px solid #aaa;
    background:white;
    border-radius:6px;
    text-align:center;
    font-size:16px;
  }

  .keypad {
    width:100%;
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:8px;
    margin-top:16px;
  }

  .key {
    background:white;
    border:1px solid #666;
    border-radius:6px;
    font-size:20px;
    padding:12px 0;
    cursor:pointer;
    user-select:none;
  }

  #clearBtn {
    margin-top:14px;
    padding:8px 16px;
    font-size:16px;
  }
</style>
</head>

<body>
<div class="container">

<h2>スケール変換</h2>

<div class="section-label">変換前　→　変換後</div>

<div class="row">
  <input class="box" id="x1">
  <span>→</span>
  <input class="box" id="y1">
</div>

<div class="row">
  <input class="box" id="x2">
  <span>→</span>
  <input class="box" id="y2">
</div>

<div id="formula">y = ax + b</div>

<div class="section-label">測定値　→　結果</div>

<div class="row">
  <input class="box" id="xm">
  <span>→</span>
  <input class="box" id="res" readonly>
</div>

<button id="clearBtn">クリア</button>

<div class="keypad">
  <div class="key">7</div><div class="key">8</div><div class="key">9</div>
  <div class="key">4</div><div class="key">5</div><div class="key">6</div>
  <div class="key">1</div><div class="key">2</div><div class="key">3</div>
  <div class="key">0</div><div class="key">.</div><div class="key">←</div>
</div>

</div>

<script>
let active = null;

document.querySelectorAll("input.box").forEach(i=>{
  i.addEventListener("focus", ()=>{
    active = i;
    i.value = "";
    compute();
  });
  i.addEventListener("input", compute);
});

function trim(v){
  return String(v).replace(/\.0+$|(\.\d*?)0+$/,'$1').replace(/\.$/,'');
}

document.querySelectorAll(".key").forEach(k=>{
  k.addEventListener("click", ()=>{
    if(!active) return;
    if(k.textContent==="←"){ active.value = active.value.slice(0,-1); }
    else { active.value += k.textContent; }
    compute();
  });
});

function compute(){
  let x1v=parseFloat(x1.value), x2v=parseFloat(x2.value);
  let y1v=parseFloat(y1.value), y2v=parseFloat(y2.value);
  let xmVal=parseFloat(xm.value);

  if(isFinite(x1v)&&isFinite(x2v)&&isFinite(y1v)&&isFinite(y2v)){
    let a=(y2v-y1v)/(x2v-x1v);
    let b=y1v - a*x1v;
    formula.textContent=`y = ${trim(a)}x + ${trim(b)}`;
    if(isFinite(xmVal)){
      res.value = trim(a*xmVal+b);
    }
  }
}

clearBtn.onclick = ()=>{
  document.querySelectorAll("input.box").forEach(i=>i.value="");
  res.value="";
  formula.textContent="y = ax + b";
};
</script>

</body>
</html>
