<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>スケール変換</title>

<style>
body{
  background:#fafafa;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif;
  margin:0; padding:20px;
  text-align:center;
}

h1{ margin-bottom:20px; }

.container{ max-width:360px; margin:0 auto; }

label{
  font-size:14px;
  display:block;
  margin-bottom:4px;
}

.input-row{
  display:flex; justify-content:center; align-items:center;
  gap:10px; margin-bottom:14px;
}

input{
  width:120px;
  height:38px;
  font-size:18px;
  text-align:center;
  border:1px solid #ccc;
  border-radius:6px;
}

#formula{
  width:100%;
  margin:18px auto;
  height:38px;
  border:1px solid #ccc;
  border-radius:6px;
  font-size:16px;
  display:flex; justify-content:center; align-items:center;
  background:white;
}

#keypad{
  margin-top:18px;
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  gap:8px;
}

.key{
  height:48px;
  background:white;
  border:1px solid #ccc;
  border-radius:6px;
  font-size:20px;
  display:flex; justify-content:center; align-items:center;
  cursor:pointer;
}
</style>
</head>

<body>
<h1>スケール変換</h1>

<div class="container">

  <!-- 1点目 -->
  <label>変換前</label>
  <label style="position:relative; left:-110px; font-size:13px;">1点目</label>
  <div class="input-row">
    <input id="x1">
    <span>→</span>
    <input id="y1">
  </div>

  <!-- 2点目 -->
  <label style="position:relative; left:-110px; font-size:13px;">2点目</label>
  <div class="input-row">
    <input id="x2">
    <span>→</span>
    <input id="y2">
  </div>

  <!-- 計算式 -->
  <div id="formula">y = ax + b</div>

  <!-- 測定値 / 結果 -->
  <label style="position:relative; left:-110px; font-size:13px;">測定値</label>
  <label style="position:relative; left:110px; top:-18px; font-size:13px;">結果</label>
  <div class="input-row" style="margin-top:-12px;">
    <input id="xm">
    <span>→</span>
    <input id="ym">
  </div>

  <!-- テンキー -->
  <div id="keypad">
    <div class="key">7</div><div class="key">8</div><div class="key">9</div>
    <div class="key">4</div><div class="key">5</div><div class="key">6</div>
    <div class="key">1</div><div class="key">2</div><div class="key">3</div>
    <div class="key">0</div><div class="key">.</div><div class="key">←</div>
  </div>

</div>

<script>
const el = {
  x1: document.querySelector("#x1"),
  y1: document.querySelector("#y1"),
  x2: document.querySelector("#x2"),
  y2: document.querySelector("#y2"),
  xm: document.querySelector("#xm"),
  ym: document.querySelector("#ym"),
  formula: document.querySelector("#formula")
};

/* ✅ 起動時デフォルト値（あなた指定通り） */
el.x1.value = "4";
el.y1.value = "0";
el.x2.value = "20";
el.y2.value = "";   // ← ここは空欄指定

function compute(){
  const x1 = parseFloat(el.x1.value);
  const y1 = parseFloat(el.y1.value);
  const x2 = parseFloat(el.x2.value);
  const y2 = parseFloat(el.y2.value);

  if(isFinite(x1) && isFinite(y1) && isFinite(x2) && isFinite(y2) && x1 !== x2){
    const a = (y2 - y1) / (x2 - x1);
    const b = y1 - a * x1;
    el.formula.textContent = `y = ${a.toFixed(3).replace(/\\.0+$/, "")}x + ${b.toFixed(3).replace(/\\.0+$/, "")}`;

    const xm = parseFloat(el.xm.value);
    if(isFinite(xm)){
      const y = a * xm + b;
      el.ym.value = y.toFixed(3).replace(/\\.0+$/, "");
    }
  } else {
    el.formula.textContent = "y = ax + b";
    el.ym.value = "";
  }
}

for(const k in el){
  el[k].addEventListener("input", compute);
}

/* ✅ 入力欄クリックで自動クリア */
document.querySelectorAll("input").forEach(input=>{
  input.addEventListener("focus",()=> input.select());
});

let target = null;
document.querySelectorAll("input").forEach(i=> i.addEventListener("focus",()=> target=i));

document.querySelectorAll(".key").forEach(btn=>{
  btn.addEventListener("click",()=>{
    if(!target) return;
    const v = btn.textContent;
    if(v === "←"){ target.value = target.value.slice(0,-1); }
    else{ target.value += v; }
    compute();
  });
});
</script>

</body>
</html>
